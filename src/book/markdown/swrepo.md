## BPKs and Software repository {#user.swrepository}

### Been package (BPK) {#user.swrepository.bpk}
Been package, shortly BPK, contains sources and descriptors needed to run tasks, task contexts and benchmarks.
Each package has its own unique identifier with structure similar to identifiers used by Maven. The identifier
consists of three parts: 

1. **group ID** -  	A universally unique identifier for a BPK. It is normal to use a fully-qualified package name to distinguish it from other BPK packages with a similar name (eg. cz.been.example).
2. **bpk ID** - The identifier for this BPK that is unique within the group given by the group ID.
3. **version** - The current version of the BPK.

BPK package is represented by single file with **\*.bpk** suffix. In fact the bpk file is simple zip file
with strictly defined structure described below.

    package.bpk
       \___ config.xml
       \___ files/
       \___ lib/
       \___ tcds/
       \___ tds/


1. ***config.xml*** file - Main configuration XML descriptor of BPK. It consists of two main sections:
    - **metaInf** section - there is specified unique identifier of the BPK. 
    - **runtime** section - there is specified runtime type. Been supports two runtime types - **JavaRuntime** and **NativeRuntime**. 
        - **JavaRuntime** - used to define that the tasks/task context/benchmarks is written in language supported by JVM. You must also specify name of the jar with implementation of your task/task context/benchmark.
        - **NativeRuntime** - used to define that the task/task context/benchmark is not written in language supported by JVM. In case you use this type of runtime you must specify name of runnable binary with implementation of your task/task context/benchmark.

    Following examples shows valid descriptors for *java* and *native* runtimes.

```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns2:bpkConfiguration xmlns:ns2="http://been.d3s.mff.cuni.cz/bpk/config">

    <ns2:metaInf>
        <groupId>fully-quallified.group.id</groupId>
        <bpkId>bpkId</bpkId>
        <version>3.0.0-EXAMPLE-ALPHA</version>
    </ns2:metaInf>
    
    <ns2:runtime xsi:type="ns2:JavaRuntime"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <jarFile>packed_jar_with_tasks.jar</jarFile>
    </ns2:runtime>
    
</ns2:bpkConfiguration>
```


```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns2:bpkConfiguration xmlns:ns2="http://been.d3s.mff.cuni.cz/bpk/config">

    <ns2:metaInf>
        <groupId>fully-quallified.group.id</groupId>
        <bpkId>bpkId</bpkId>
        <version>3.0.0-EXAMPLE-ALPHA</version>
    </ns2:metaInf>
    
    <ns2:runtime xsi:type="ns2:NativeRuntime"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <binary>name_of_executable</binary>
    </ns2:runtime>
            
</ns2:bpkConfiguration>
```

2. ***files/*** directory - In case that you specified runtime as ***JavaRuntime*** in the ***config.xml*** descriptor, you have to place here the jar with implementation of your task/task context/benchmark. If you specified runtime as ***NativeRuntime***, you have to place here the executable file specified in descriptor. 

3. ***lib/*** directory - In case that you specified runtime as ***JavaRuntime***, you should place here all java dependencies of jar file specified in *config.xml*. These dependencies will be placed to the classpath of the running task/task context/benchmark. 

4. ***tcds/*** directory - In this directory are placed task context descriptors.

5. ***tds/*** directory - In this directory are placed task descriptors.


When a task/task context/benchmark is started, *lib/*, *files*, *tds/* and *tcds/* directories are copied into the working directory of this task.

Now you have all informatin needed to build BPK package by hand. But better approache is to use [Been Bpk Plugin](#user.bpkplugin).

**Note: ** You can see more elements in *context.xml* file generated by [Been BPK plugin](#user.bpkplugin) and you can also find definitions of these elements in corresponding \*.xsd file, but these elements are not used in actual version of BEEN. 





### Software repository {#user.swrepository.swrepository}
The main purpose of the software repository is to store BPK packages for future use. SR is implemented as a service which can be started on arbitrary BEEN node. You can upload prepared BPK packages to and download them from SR. Provided implementation is based on embedded HTTP server.


### BPK versioning {#user.swrepository.bpkversioning}
Software repository does not allow reuploading BPKs with same groupId, bpkId and version. If you want to reupload BPK, you have to change its version. The reason for this limitation is simple - it prevents inconsistency of stored data, because changes in production code may cause unpredictable behavior. Imagine a situation if you rename a field on an object and you want to deserialize already stored measured data from previous benchmark runs. As you can see it is a legitime restriction of user comfort.

As usual, there exists an exception. BPKs with version suffixed by **'-SNAPSHOT'** can be reuploaded to sofware repository again and again. Use this version suffix when you are developing and testing new BPK implementation but do not use it in production environment. 



